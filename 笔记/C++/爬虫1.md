# C++爬取曾经玩过的游戏真人秀 
在windows下,使用curl下载网址内容,C++筛选信息

C++只做了调用curl和文件处理的工作,严格意义讲,能不算C++爬虫

# 下载
```c++
#include<iostream>
#include<fstream>
#include<string>
using namespace std;
int main(int arvc, char* arvg) {
	string s1 = "curl https://mx2.duoyi.com/show/";
	string s2 = ".shtm >>"; 
	string s3 = ".txt";
	int i = 1;
	string s;
	while (i++) {
		s = s1 + to_string(i) + s2+ to_string(i)+s3;
		cout << s << endl;
		system(s.c_str());
	}
}
```
# 手动处理
删掉大小为4K的文件
# 自动处理
```C++
#include<iostream>
#include<fstream>
#include<string>
using namespace std;
int GetLen(char* cIn);
fstream outfile;
fstream infile; 
string sLine;
char* line = new char[1000];
void Find() {
	// 图片
	for (int i = 0; i < 120; i++)
		infile.getline(line, 1000);
	strcpy_s(line,1000, (const char*)&line[133]);
	line[67] = '\0';
	outfile << line<<",";
	// 昵称
	for (int i = 0; i < 30; i++)
		infile.getline(line, 1000);
	strcpy_s(line, 1000, (const char*)& line[38]);
	line[GetLen(line) - 5] = '\0';
	outfile << line << ",";
	// 性别
	for (int i = 0; i < 2; i++)
		infile.getline(line, 1000);
	strcpy_s(line, 1000, (const char*)& line[38]);
	line[6] = '\0';
	outfile<< line << ",";
	// 服务器
	for (int i = 0; i < 4; i++)
		infile.getline(line, 1000);
	strcpy_s(line, 1000, (const char*)& line[26]);
	line[12] = '\0';
	outfile << line << ",";
	// ID
	for (int i = 0; i < 2; i++)
		infile.getline(line, 1000);
	strcpy_s(line, 1000, (const char*)& line[26]);
	line[GetLen(line)-5] = '\0';
	outfile << line << endl;
}
int GetLen(char* cIn) {
	int i = 0;
	while (cIn[i] != '\0')
		i++;
	return i;
}
int main(int arvc, char* arvg) {
	int i = 0;
	outfile.open("recode.txt", ios::app);
	while (i<12000) {
		infile.open(to_string(i) + ".txt");
		if (infile.is_open()) {
			Find();
		}
		i++;
		infile.close();
	}
}
```
# 加强版文字处理
```C++
#include<iostream>
#include<fstream>
#include<string>
using namespace std;
class ALine {
private:
	int len;
	char* cLine;
public:
	ALine(char* cIn) {
		len = GetLen(cIn) + 1;
		cLine = new char[len];
		strcpy_s(cLine, len, cIn);
	}
	~ALine() {
		delete cLine;
	}
	static int GetLen(char* cIn) {
		int iret = 0;
		for (int i = 0; cIn[i] != '\0'; iret = ++i) {}
		return iret;
	}
	int Search(char* cIn) {
		int iIn = GetLen(cIn);
		for (int i = 0; i < len - iIn; i++) {
			if (memcmp(&cLine[i], cIn, iIn * sizeof(char)) == 0)
				return i;
		}
		return 0;
	}
	void CutHead(int iIn) {
		strcpy_s(cLine, len, &cLine[iIn]);
		len = GetLen(cLine);
	}
	void CutEnd(int iIn) {
		cLine[iIn] = '\0';
		len = GetLen(cLine);
	}
	char* GetcLine() {
		return cLine;
	}
};
class AFile {
private:
	fstream InFile;
	char* line;
	char* search;
public:
	AFile(int i) {
		cout << i << endl;
		InFile.open(to_string(i) + ".txt");
		line = new char[1000];
		search = new char[20];
	}
	~AFile() {
		InFile.close();
		delete line;
		delete search;
	}
	string Main() {
		if (!InFile.is_open()) {
			return "";
		}
		string picture(GetPicture());
		string name(GetName());
		string gender(GetGender());
		string server(GetServer());
		string ID(GetID());
		return server + "," + ID + "," + gender + "," + name + "," + picture+"\n";
	}
	char* GetPicture() {
		for (int i = 0; i < 120; i++)
			InFile.getline(line, 1000);
		ALine aLine(line);
		strcpy_s(search, 20, "src");
		aLine.CutHead(aLine.Search(search) + 37);
		strcpy_s(search, 20, "jpg");
		aLine.CutEnd(aLine.Search(search) + 3);
		strcpy_s(line, 1000, aLine.GetcLine());
		return line;
	}
	char* GetName() {
		for (int i = 0; i < 30; i++)
			InFile.getline(line, 1000);
		ALine aLine(line);
		strcpy_s(search, 20, "34%");
		aLine.CutHead(aLine.Search(search) + 5);
		strcpy_s(search, 20, "td");
		aLine.CutEnd(aLine.Search(search) - 2);
		strcpy_s(line, 1000, aLine.GetcLine());
		return line;
	}
	char* GetGender() {
		for (int i = 0; i < 2; i++)
			InFile.getline(line, 1000);
		ALine aLine(line);
		strcpy_s(search, 20, "31%");
		aLine.CutHead(aLine.Search(search) + 5);
		strcpy_s(search, 20, "td");
		aLine.CutEnd(aLine.Search(search) - 2);
		strcpy_s(line, 1000, aLine.GetcLine());
		return line;
	}
	char* GetServer() {
		for (int i = 0; i < 4; i++)
			InFile.getline(line, 1000);
		ALine aLine(line);
		strcpy_s(search, 20, "td");
		aLine.CutHead(aLine.Search(search) + 3);
		strcpy_s(search, 20, "td");
		aLine.CutEnd(aLine.Search(search) - 2);
		strcpy_s(line, 1000, aLine.GetcLine());
		return line;
	}
	char* GetID() {
		for (int i = 0; i < 2; i++)
			InFile.getline(line, 1000);
		ALine aLine(line);
		strcpy_s(search, 20, "td");
		aLine.CutHead(aLine.Search(search) + 3);
		strcpy_s(search, 20, "td");
		aLine.CutEnd(aLine.Search(search) - 2);
		strcpy_s(line, 1000, aLine.GetcLine());
		return line;
	}
};
int main(int arvc, char* arvg) {
	fstream OutFile;
	OutFile.open("recode.txt");
	int i = 0;
	while (i < 12000) {
		AFile aFile(i);
		OutFile << aFile.Main();
		i++;
	}
}
```
```C++
//多线程爬虫
#include <thread>
#include"ALine.h"
#include"AFile.h"
#include <mutex>
#include<Windows.h>
//74600
using namespace std;
mutex mx[10];
void output(int i) {
	string s1 = "start curl https://mx2.duoyi.com/show/";
	string s2 = ".shtm -o ";
	string s3 = ".txt";
	string s;
	s = s1 + to_string(i) + s2 + to_string(i) + s3;
	cout << s << endl;
	system(s.c_str());
}
int main(int arvc, char* arvg) {
	for (int i = 73160; i < 73200; i++) {
			thread t(output, i);
			t.detach();
			Sleep(250);
	}
}
```
```C++
//文字处理
#include<iostream>
#include<fstream>
#include<string>
#include"ALine.h"
#include"AFile.h"
using namespace std;
int main(int arvc, char* arvg) {
	fstream OutFile;
	OutFile.open("recode.txt");
	int i = 19999;
	while (i < 50000) {
		AFile aFile(i);
		OutFile << aFile.Main();
		i++;
	}
}
```
```C++
// 又一次改进,取消了多线程,根据链接爬取,提高效率
#include <thread>
#include"ALine.h"
#include"AFile.h"
#include <mutex>
#include<Windows.h>
using namespace std;
mutex mx[10];
int main(int arvc, char* arvg) {
	fstream outFile;
	outFile.open("recode.txt",ios::app);
	if (!outFile.is_open())
		exit(-1);
	string s1 = "curl https://mx2.duoyi.com/show/", s2 = ".shtm -o out.txt", s;
	char* next = new char[20];
	char* last = new char[20];
	// 输入起始页
	cin >> next;
	s = s1 + next + s2;
	system(s.c_str());
	AFile* aFile;
	// 读取起始页
	while (true) {
		aFile = new AFile("out");
		strcpy_s(last, 20, next);
		string ret=(string)last + "," + aFile->Main(next);
		outFile << ret<<endl;
		s = s1 + next + s2;
		system(s.c_str());
		delete aFile;
	}
}

```
```C++
// 存档
#include <thread>
#include"ALine.h"
#include"AFile.h"
#include <mutex>
#include<Windows.h>
using namespace std;
mutex mx[10];
int main(int arvc, char* arvg) {
	fstream outFile;
	outFile.open("recode.txt",ios::app);
	if (!outFile.is_open())
		exit(-1);
	string s1 = "curl https://www.zhihu.com/question/20703994", s2 = " -o out.txt", s;
	s1.find();
	char* next = new char[20];
	char* last = new char[20];
	// 输入起始页
	cin >> next;
	s = s1 + s2;
	system(s.c_str());
	return 0;
	AFile* aFile;
	// 读取起始页
	while (true) {
		aFile = new AFile("out");
		strcpy_s(last, 20, next);
		string ret=(string)last + "," + aFile->Main(next);
		outFile << ret<<endl;
		s = s1 + next + s2;
		system(s.c_str());
		delete aFile;
	}
}
```
```C++
// 2019/06/13 14:45
class MyTag {
private:
	MyString tagName;
	ChildTag* childTagList;
public:
	MyTag(const char * name) {
		tagName = name;
	}
	void AddChildTag() {

	}
};
class ChildTag {
public:
	MyString tagName;
	MyTag* tagPtr;
	ChildTag() {
	}
};
```
```C++
// 2019/06/13 15:39
#include<iostream>
#include <string>
#include<fstream>
#include"MyString.h"
using namespace std;
int main(int arvc, char* arvg) {
	system("CHCP 65001");
	fstream file("out.html");
	MyString ms;
	file >> ms;
	ms.remove('\n');
	file.close();
	int body = ms.Find("<body>");
	cout << body << endl;
	ms.CutHead(body + 6);
	body = ms.Find("</body>");
	ms.CutEnd(body);
	int astart = ms.Find("<a ");
	int aend = ms.Find("</a") + 4;
	while (astart != -1) {
		int len = aend - astart + 1;
		char* href = new char[len];
		memset(href, '\0', len);
		memcpy(href, &ms.GetString()[astart], len-1);
		cout << href << endl;
		ms.CutHead(aend);
		astart = ms.Find("<a ");
		aend = ms.Find("</a") + 4;
	}
}
```
```C++
//20190614 14:14继续备份
char* line = new char[100];
	MyString *ms;
	MyString *dl;
	fstream file("真人秀url.txt");
	int m;
	int i = 0;
	while (!file.eof()) {
		i++;
		ms = new MyString;
		file.getline(line, 100);
		ms->add("curl w2.duoyi.com/res/mx2/rs/source/");
		ms->add(line);
		ms->add(" -s -o out.txt");
		system(ms->GetString());
		delete ms;
		ms = new MyString;
		fstream out("out.txt");
		out>>*ms;
		out.close();
		int astart=ms->Find("href");
		ms->CutHead(astart+12);
		int aend = ms->Find("jpg");
		ms->CutEnd(aend + 3);
		ms->exchange("%2f", "/");
		dl = new MyString;
		dl->add("curl ");
		dl->add(ms->GetString());
		dl->add(" -s -o ");
		dl->add(line);
		system(dl->GetString());
		delete dl;
		delete ms;
		cout << "第" << i << "张"<<endl;
	}
	file.close();
	return 0;
```
```C++
// 2019/06/14 20:31
// 筛选还没下载的照片(顺序一致的两个文件,从B中少筛选出A不存在的行,A是B的子集)
nt main(int arvc, char** arvg) {
	fstream f1("已下载.txt"), f2("全部.txt"), f3("未下载.txt");
	string s1, s2;
	while (true) {
		f1 >> s1;
		f2 >> s2;
		while (s1 != s2) {
			f3 << s2 << endl;
			f2 >> s2;
		}
		if (f1.eof() || f2.eof()) {
			while (!f2.eof()) { f2 >> s2; f3 << s2; } 
			return 0;
		}// 退出条件
	}
}
```